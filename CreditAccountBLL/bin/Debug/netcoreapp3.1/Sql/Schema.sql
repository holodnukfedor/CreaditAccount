IF OBJECT_ID ('dbo.Users', 'U') IS NULL
BEGIN
	CREATE TABLE [dbo].[Users](
		[Id] [bigint] IDENTITY(-9223372036854775808,1) NOT NULL,
		[Name] [nchar](50) NOT NULL,
	 CONSTRAINT [PK_Users] PRIMARY KEY CLUSTERED 
	(
		[Id] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]
END
GO

IF OBJECT_ID ('dbo.Accounts', 'U') IS NULL
BEGIN
	CREATE TABLE [dbo].[Accounts](
		[Id] [bigint] IDENTITY(-2147483647,1) NOT NULL,
		[UserId] [bigint] NOT NULL CONSTRAINT [FK_Accounts_Users_UserId] FOREIGN KEY([UserId]) REFERENCES [dbo].[Users] ([Id]) ON DELETE CASCADE,
		[CurrencyCode] [int] NOT NULL,
		[Money] [money] NOT NULL,
	 CONSTRAINT [PK_Accounts] PRIMARY KEY CLUSTERED 
	(
		[Id] ASC
	)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
	) ON [PRIMARY]
END
GO

IF NOT EXISTS(SELECT * FROM sys.indexes WHERE name = 'IX_Accounts_UserId_CurrencyCode' AND object_id = OBJECT_ID('dbo.Accounts'))
BEGIN
	CREATE UNIQUE NONCLUSTERED INDEX [IX_Accounts_UserId_CurrencyCode] ON [dbo].[Accounts]
	(
		[UserId] ASC,
		[CurrencyCode] ASC
	)
	INCLUDE([Money]) WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
END
GO
